<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Holiday Mixer v2 ‚Äî Enhanced Slot Machine</title>
<style>
  :root{
    --bg:#080d22; --ink:#f7fbff; --muted:#c7d4ff; --rim:#2a3570; --gold:#ffd54f; --good:#29e3a2;
    --r1a:#0e5ce6; --r1b:#7ac3ff; --r2a:#7b2fe0; --r2b:#f3a9ff; --r3a:#0ea66c; --r3b:#aef7d0;
    --r4a:#ffb703; --r4b:#ffe9a8; --r5a:#ff6a00; --r5b:#ffb38a; --r6a:#e600ff; --r6b:#ff8aff; --r7a:#00ffcc; --r7b:#aaffff;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:radial-gradient(1600px 1200px at 50% -20%, #2a3570 0%, var(--bg) 60%);
    color:var(--ink); font-family:'Open Sans', sans-serif; font-size:16px;
  }
  header{padding:26px 16px; text-align:center; position:relative}
  h1{margin:0 0 10px; font-size:24px; font-family:'Comic Neue', cursive; letter-spacing:.2px}
  .note{color:var(--muted); font-size:14px}
  .lang{position:absolute; top:12px; right:16px; display:flex; gap:10px}
  .lang button{cursor:pointer; border:0; border-radius:12px; padding:10px 16px; font-weight:400; font-size:14px; background:#202a57; color:#d7e5ff; font-family:'Open Sans', sans-serif;}
  .lang .on{background:linear-gradient(180deg,#15a9ff,#0675ce); color:#fff}
  .wrap{max-width:1500px; margin:0 auto; padding:12px 16px 90px}
  .board{background:linear-gradient(180deg,#0f163d,#0a102c); border:1px solid var(--rim); border-radius:22px;
         padding:20px; box-shadow:0 30px 80px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.05)}
  .actions{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-bottom:14px}
  .btn{cursor:pointer; border:0; border-radius:14px; padding:14px 18px; font-weight:400; font-size:14px; font-family:'Open Sans', sans-serif;}
  .btn-primary{background:linear-gradient(180deg,#15a9ff,#0675ce); color:#fff}
  .btn-ghost{background:#202a57; color:#d7e5ff}
  .btn-mode{background:linear-gradient(180deg,#ff6a00,#ffb38a); color:#fff}
  .lever{margin-left:auto; display:flex; align-items:center; gap:10px}
  .stick{width:12px; height:70px; background:#aaa; border-radius:6px; position:relative}
  .knob{width:34px; height:34px; background:var(--gold); border-radius:50%; position:relative; top:-8px; left:-10px;
        box-shadow:0 4px 10px rgba(0,0,0,.6); cursor:pointer}
  .headerlights{height:12px; border-radius:8px; margin:10px 0 12px;
    background:linear-gradient(90deg,#ff5f5f,#ffd54f,#6dff6d,#6fd3ff,#b58cff,#ff5f5f);
    background-size:300% 100%; animation:lights 6s linear infinite; opacity:.75}
  .machine{position:relative; display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:18px; align-items:stretch;
           border:2px solid #c8a23a; border-radius:18px; padding:16px; background:linear-gradient(180deg,#1a2149,#0b1130)}
  .machine.win{box-shadow:0 0 0 6px rgba(255,213,79,.7), 0 0 40px 14px rgba(255,213,79,.45); animation:glow 1s ease-in-out 9;}
  @keyframes lights{0%{background-position:0 0}100%{background-position:300% 0}}
  @keyframes glow{0%,100%{filter:brightness(1)}50%{filter:brightness(1.25)}}
  .reel{border-radius:16px; padding:14px; position:relative; box-shadow:inset 0 0 28px rgba(0,0,0,.38);
        border:1px solid rgba(255,255,255,.1)}
  .reel[data-i="0"]{background:linear-gradient(180deg,var(--r1a),var(--r1b))}
  .reel[data-i="1"]{background:linear-gradient(180deg,var(--r2a),var(--r2b))}
  .reel[data-i="2"]{background:linear-gradient(180deg,var(--r3a),var(--r3b))}
  .reel[data-i="3"]{background:linear-gradient(180deg,var(--r4a),var(--r4b))}
  .reel[data-i="4"]{background:linear-gradient(180deg,var(--r5a),var(--r5b))}
  .reel[data-i="5"]{background:linear-gradient(180deg,var(--r6a),var(--r6b))}
  .reel[data-i="6"]{background:linear-gradient(180deg,var(--r7a),var(--r7b))}
  .chrome{position:absolute; inset:0; border-radius:16px; padding:8px; pointer-events:none;}
  .chrome:before{content:""; position:absolute; inset:0; border-radius:16px; border:2px solid rgba(255,255,255,.5);
                 box-shadow:inset 0 0 14px rgba(255,255,255,.35), inset 0 0 34px rgba(255,255,255,.18)}
  .title{font-size:16px; letter-spacing:.4px; color:#0b1030;
         margin-bottom:10px; font-weight:400; display:flex; align-items:center; gap:8px; font-family:'Comic Neue', cursive;}
  .title .ico{font-size:18px}
  .window{position:relative; height:210px; overflow:hidden; border-radius:14px; background:rgba(10,16,39,.25);
          border:2px solid rgba(255,255,255,.7); backdrop-filter: blur(1px)}
  .window.stop{animation:stopPulse .28s ease;}
  @keyframes stopPulse{0%{box-shadow:0 0 0 0 rgba(255,255,255,.0)}100%{box-shadow:0 0 0 10px rgba(255,255,255,.0)}}
  .payline{position:absolute; left:0; right:0; top:70px; height:70px;
           border-top:2px dashed #fff; border-bottom:2px dashed #fff;
           box-shadow:0 0 12px rgba(255,255,255,.5) inset; pointer-events:none; transition:box-shadow .25s}
  .payline.almost{box-shadow:0 0 18px rgba(255,213,79,.9) inset, 0 0 12px rgba(255,213,79,.6) inset}
  .strip{list-style:none; padding:0; margin:0; transition: transform .55s cubic-bezier(.2,.8,.2,1)}
  .cell{
    height:70px; display:flex; align-items:center; justify-content:center; padding:0 8px;
    text-align:center; font-weight:700; font-size:14px; line-height:1.2;
    color:#0a1130; cursor:pointer; user-select:none;
    background:linear-gradient(180deg,rgba(255,255,255,.9),rgba(255,255,255,.56)); position:relative;
    white-space: normal; word-wrap: break-word; overflow: hidden;
  }
  .cell:nth-child(odd){background:linear-gradient(180deg,rgba(255,255,255,.97),rgba(255,255,255,.65))}
  .cell img{width:40px; height:40px; object-fit:contain; margin-right:4px;}
  .controls{display:flex; gap:8px; margin-top:10px}
  .btn-mini{cursor:pointer; border:0; border-radius:12px; padding:8px 12px; font-weight:400; font-size:12px; background:rgba(0,0,0,.22); color:#0b1030; border:1px solid rgba(255,255,255,.6); font-family:'Open Sans', sans-serif;}
  .status{margin-top:12px; min-height:30px; font-size:16px; font-family:'Open Sans', sans-serif;}
  .success{ color:var(--good) }
  .win-banner{
    position:fixed; left:50%; top:12%; transform:translateX(-50%) scale(.95);
    background:linear-gradient(180deg,#fff7c2,#ffe37a);
    border:4px solid #e8b700; color:#5a4100; font-weight:400; padding:16px 22px; border-radius:16px; font-size:24px;
    box-shadow:0 14px 40px rgba(0,0,0,.35); display:none; z-index:2000; animation:pop .6s ease; font-family:'Comic Neue', cursive;
  }
  .win-banner.show{display:block}
  @keyframes pop{0%{transform:translateX(-50%) scale(.6); opacity:0} 100%{transform:translateX(-50%) scale(.95); opacity:1}}
  .confetti{position:fixed; top:-2vh; width:9px; height:14px; border-radius:2px; z-index:1999}
  .info{margin-top:18px; background:linear-gradient(180deg,#0e1536,#0a102a); border:1px solid var(--rim); border-radius:16px; padding:18px;
        box-shadow:inset 0 0 24px rgba(0,0,0,.35)}
  .info h3{margin:0 0 12px; font-size:20px; font-family:'Comic Neue', cursive;}
  .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:14px}
  .card{background:#0c122e; border:1px solid #2b3569; border-radius:12px; padding:14px}
  .card h4{margin:0 0 8px; font-size:14px; color:#bcd1ff; letter-spacing:.4px; font-family:'Open Sans', sans-serif;}
  .card .v{font-weight:400; font-size:16px; font-family:'Open Sans', sans-serif;}
  .card img{width:100%; height:auto; border-radius:8px;}
  .card video{width:100%; height:auto;}
  .card audio{width:100%;}
  .ai-btn{ cursor:pointer; background:linear-gradient(180deg,#ff00ff,#8a00ff); color:#fff; padding:10px; border-radius:12px; margin-top:10px; font-family:'Open Sans', sans-serif; }
  /* RTL tweaks */
  [dir="rtl"] .machine{direction:rtl}
  [dir="rtl"] .title, [dir="rtl"] .cell, [dir="rtl"] .note {text-align:right}
  /* Particles for WOW */
  .particles{position:absolute; inset:0; pointer-events:none;}
  .particle{position:absolute; width:5px; height:5px; background:#ffd54f; border-radius:50%; animation:particleAnim 2s linear infinite;}
  @keyframes particleAnim{0%{transform:translateY(0) scale(1); opacity:1} 100%{transform:translateY(-100px) scale(0); opacity:0}}
  /* Add Google Fonts */
  @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Open+Sans:wght@400;700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Alef:wght@400;700&display=swap'); /* Hebrew support with bold */
</style>
</head>
<body>
<header>
  <div class="lang">
    <button id="lang-en" class="on">English</button>
    <button id="lang-he">‚Äè◊¢◊ë◊®◊ô◊™</button>
  </div>
  <h1 id="title">Holiday Mixer v2 ‚Äî Enhanced Slot Machine</h1>
  <div class="note" id="subtitle">Choose mode, spin, align holidays! Earn points for power-ups.</div>
</header>
<div class="wrap">
  <div class="board">
    <div class="actions">
      <button class="btn btn-mode" id="btn-easy">Easy (3 Reels)</button>
      <button class="btn btn-mode" id="btn-medium">Medium (5 Reels)</button>
      <button class="btn btn-mode" id="btn-hard">Hard (7 Reels)</button>
      <button class="btn btn-primary" id="btn-spin-all">üé∞ <span data-i18n="spinAll">Spin All</span></button>
      <button class="btn btn-ghost" id="btn-new" data-i18n="newRound">New Round</button>
      <button class="btn btn-ghost" id="btn-hint">Hint: OFF</button>
      <div class="lever" title="Spin All">
        <div class="stick"></div><div class="knob" id="lever"></div>
      </div>
    </div>
    <div class="headerlights"></div>
    <div class="machine" id="machine"></div>
    <div class="status" id="status">Score: 0 | Time: 120s</div>
    <div class="info" id="info" style="display:none">
      <h3 id="info-title">Holiday</h3>
      <div class="grid">
        <div class="card"><h4 id="lbl-story">Story</h4><div class="v" id="i-story">‚Äî</div></div>
        <div class="card"><h4 id="lbl-food">Food</h4><div class="v" id="i-food">‚Äî</div></div>
        <div class="card"><h4 id="lbl-season">Season</h4><div class="v" id="i-season">‚Äî</div></div>
        <div class="card"><h4 id="lbl-symbol">Symbol</h4><div class="v" id="i-symbol">‚Äî</div></div>
      </div>
      <div class="grid">
        <div class="card" id="photo-card" style="display:none">
          <h4>Photo</h4>
          <img id="holiday-photo" src="" alt="Holiday photo">
        </div>
        <div class="card" id="video-card" style="display:none">
          <h4>Video</h4>
          <video id="win-video" controls>
            <source type="video/mp4">
          </video>
        </div>
        <div class="card" id="song-card" style="display:none">
          <h4>Song</h4>
          <audio id="holiday-song" controls>
            <source type="audio/m4a">
          </audio>
        </div>
      </div>
      <div style="margin-top:10px; color:#bcd1ff" id="coming">Explore the photo, video, and song for this holiday!</div>
      <button class="ai-btn" id="ai-ask">Ask AI for More</button>
    </div>
  </div>
</div>
<div class="win-banner" id="win-banner">üéâ YOU WIN! üéâ</div>
<!-- Updated Audio Sources with Local Paths -->
<audio id="spin-sound" src="./audio files/HAVA NAGILA.m4a"></audio> /* General spin sound */
<audio id="win-sound"></audio> /* Dynamically set per holiday on win */
<script>
(function(){
  /* --------- Data as JSON for Modularity with Media Mapping --------- */
  const DATA = {
    en: {
      ui: {
        title: "Holiday Mixer v2 ‚Äî Enhanced Slot Machine",
        subtitle: "Choose mode, spin, align holidays! Earn points for power-ups.",
        spinAll: "Spin All", newRound:"New Round",
        cols:{name:"Name", story:"Story", food:"Food", season:"Season", symbol:"Symbol", extra1:"Custom1", extra2:"Custom2"},
        coming:"Explore the photo, video, and song for this holiday!",
        win:(n)=>`üéâ You Win! It‚Äôs ${n}`, hintOff:"Hint: OFF", hintOn:"Hint: ON", looks:"Looks good!",
        icons:{name:"üïØÔ∏è", story:"üìñ", food:"ü•ô", season:"üçÇ", symbol:"‚ú°Ô∏è", extra1:"üîÆ", extra2:"üåü"}
      },
      holidays:{
        roshhashanah:{key:"roshhashanah",name:"Rosh Hashanah",story:"Jewish New Year; introspection and renewal",food:"Apples & honey; pomegranate",season:"Autumn ‚Ä¢ Tishrei (early)",symbol:"Shofar (ram's horn)",extra1:"Sweet year wish",extra2:"Honey dip", image:"./photos/Shofar_in_Rosh_Hashanah.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        yomkippur:{key:"yomkippur",name:"Yom Kippur",story:"Day of Atonement; fasting & prayer",food:"(Fast day) ‚Äì pre/post fast meals",season:"Autumn ‚Ä¢ Tishrei (mid)",symbol:"White clothing; machzor",extra1:"Atonement",extra2:"Prayer book", image:"./photos/Jews_Praying_in_the_Synagogue_on_Yom_Kippur.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        sukkot:{key:"sukkot",name:"Sukkot",story:"Festival of Booths; dwelling in sukkah",food:"Harvest meals in the sukkah",season:"Autumn ‚Ä¢ Tishrei (mid‚Äëlate)",symbol:"Lulav & etrog",extra1:"Booth dwelling",extra2:"Four species", image:"./photos/Sukkoth.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        simchattorah:{key:"simchattorah",name:"Simchat Torah",story:"Completion & restart of Torah reading",food:"Dancing sweets; kiddush treats",season:"Autumn ‚Ä¢ Tishrei (late)",symbol:"Dancing with Torah scrolls",extra1:"Torah cycle",extra2:"Joyful dance", image:"./photos/Torah_and_jad.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        hanukkah:{key:"hanukkah",name:"Hanukkah",story:"Maccabees & the oil that lasted eight days",food:"Latkes; sufganiyot",season:"Early winter ‚Ä¢ Kislev",symbol:"Menorah/Chanukiah, dreidel",extra1:"Oil miracle",extra2:"Eight lights", image:"./photos/hanukah NEROT.jpg", video:["./videos/HANNUKAH_1.mp4", "./videos/HANNUKAH_2.mp4", "./videos/HANNUKAH 3 SUFGANIOT.mp4", "./videos/HANNUKAH 4 SUFGANIOT.mp4"], song:"./audio files/MAOZ TSUR.m4a"},
        purim:{key:"purim",name:"Purim",story:"Esther & Mordechai foil Haman's plot",food:"Hamantaschen",season:"Late winter ‚Ä¢ Adar",symbol:"Megillah & grogger",extra1:"Esther story",extra2:"Noise maker", image:"./photos/PURIM HAMENTASH.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        pesach:{key:"pesach",name:"Pesach (Passover)",story:"Exodus from Egypt; freedom from slavery",food:"Matzah, maror, charoset",season:"Spring ‚Ä¢ Nisan",symbol:"Seder plate / three matzot",extra1:"Exodus",extra2:"Unleavened bread", image:"./photos/PASSOVER MATZA A.jpg", video:"./videos/PASSOVER_1.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        shavuot:{key:"shavuot",name:"Shavuot",story:"Giving of the Torah at Sinai",food:"Cheesecake & dairy dishes",season:"Early summer ‚Ä¢ Sivan",symbol:"Tablets / Torah scroll",extra1:"Torah giving",extra2:"Dairy custom", image:"./photos/2009_jni.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"}
      }
    },
    he: {
      ui: {
        title:"◊û◊¢◊®◊ë◊ú ◊î◊ó◊í◊ô◊ù v2 ‚Äî ◊û◊õ◊ï◊†◊™ ◊û◊ñ◊ú ◊û◊©◊ï◊§◊®◊™",
        subtitle:"◊ë◊ó◊®◊ï ◊û◊¶◊ë, ◊°◊ï◊ë◊ë◊ï, ◊î◊™◊ê◊ô◊û◊ï ◊ó◊í◊ô◊ù! ◊î◊®◊ï◊ï◊ô◊ó◊ï ◊†◊ß◊ï◊ì◊ï◊™ ◊ú◊ô◊õ◊ï◊ú◊ï◊™ ◊û◊ô◊ï◊ó◊ì◊ï◊™.",
        spinAll:"◊°◊ï◊ë◊ë ◊î◊õ◊ú", newRound:"◊°◊ë◊ë ◊ó◊ì◊©",
        cols:{name:"◊©◊ù ◊î◊ó◊í", story:"◊°◊ô◊§◊ï◊®", food:"◊û◊ê◊õ◊ú", season:"◊¢◊ï◊†◊î", symbol:"◊°◊û◊ú", extra1:"◊û◊ï◊™◊ê◊ù 1", extra2:"◊û◊ï◊™◊ê◊ù 2"},
        coming:"◊ó◊ß◊®◊ï ◊ê◊™ ◊î◊™◊û◊ï◊†◊î, ◊î◊°◊®◊ò◊ï◊ü ◊ï◊î◊©◊ô◊® ◊ú◊ó◊í ◊ñ◊î!",
        win:(n)=>`üéâ ◊†◊ô◊¶◊ó◊™◊ù! ◊ñ◊î ${n}`, hintOff:"◊®◊û◊ñ: ◊õ◊ë◊ï◊ô", hintOn:"◊®◊û◊ñ: ◊§◊ï◊¢◊ú", looks:"◊†◊®◊ê◊î ◊ò◊ï◊ë!",
        icons:{name:"üïØÔ∏è", story:"üìñ", food:"ü•ô", season:"üçÇ", symbol:"‚ú°Ô∏è", extra1:"üîÆ", extra2:"üåü"}
      },
      holidays:{
        roshhashanah:{key:"roshhashanah",name:"◊®◊ê◊© ◊î◊©◊†◊î",story:"◊®◊ê◊© ◊î◊©◊†◊î; ◊ó◊©◊ë◊ï◊ü ◊†◊§◊© ◊ï◊î◊™◊ó◊ì◊©◊ï◊™",food:"◊™◊§◊ï◊ó ◊ï◊ì◊ë◊©; ◊®◊ô◊û◊ï◊ü",season:"◊°◊™◊ô◊ï ‚Ä¢ ◊™◊©◊®◊ô (◊™◊ó◊ô◊ú◊™ ◊™◊©◊®◊ô)",symbol:"◊©◊ï◊§◊®",extra1:"◊ë◊®◊õ◊î ◊ú◊©◊†◊î ◊ò◊ï◊ë◊î",extra2:"◊ò◊ë◊ô◊ú◊™ ◊ì◊ë◊©", image:"./photos/Shofar_in_Rosh_Hashanah.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        yomkippur:{key:"yomkippur",name:"◊ô◊ï◊ù ◊õ◊ô◊§◊ï◊®",story:"◊ô◊ï◊ù ◊î◊õ◊ô◊§◊ï◊®◊ô◊ù; ◊¶◊ï◊ù ◊ï◊™◊§◊ô◊ú◊î",food:"(◊ô◊ï◊ù ◊¶◊ï◊ù) ‚Äî ◊ê◊®◊ï◊ó◊ï◊™ ◊ú◊§◊†◊ô/◊ê◊ó◊®◊ô",season:"◊°◊™◊ô◊ï ‚Ä¢ ◊™◊©◊®◊ô (◊ê◊û◊¶◊¢ ◊™◊©◊®◊ô)",symbol:"◊ë◊í◊ì◊ô◊ù ◊ú◊ë◊†◊ô◊ù; ◊û◊ó◊ñ◊ï◊®",extra1:"◊õ◊§◊®◊î",extra2:"◊°◊§◊® ◊™◊§◊ô◊ú◊î", image:"./photos/Jews_Praying_in_the_Synagogue_on_Yom_Kippur.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        sukkot:{key:"sukkot",name:"◊°◊ï◊õ◊ï◊™",story:"◊ó◊í ◊î◊°◊ï◊õ◊ï◊™; ◊ô◊©◊ô◊ë◊î ◊ë◊°◊ï◊õ◊î",food:"◊°◊¢◊ï◊ì◊ï◊™ ◊ß◊¶◊ô◊® ◊ë◊°◊ï◊õ◊î",season:"◊°◊™◊ô◊ï ‚Ä¢ ◊™◊©◊®◊ô (◊ê◊û◊¶◊¢÷æ◊°◊ï◊£)",symbol:"◊ú◊ï◊ú◊ë ◊ï◊ê◊™◊®◊ï◊í",extra1:"◊û◊í◊ï◊®◊ô◊ù ◊ë◊°◊ï◊õ◊î",extra2:"◊ê◊®◊ë◊¢◊™ ◊î◊û◊ô◊†◊ô◊ù", image:"./photos/Sukkoth.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        simchattorah:{key:"simchattorah",name:"◊©◊û◊ó◊™ ◊™◊ï◊®◊î",story:"◊°◊ô◊ï◊ù ◊ï◊§◊™◊ô◊ó◊î ◊û◊ó◊ì◊© ◊©◊ú ◊ß◊®◊ô◊ê◊™ ◊î◊™◊ï◊®◊î",food:"◊û◊û◊™◊ß◊ô◊ù ◊ë◊®◊ô◊ß◊ï◊ì◊ô◊ù; ◊ß◊ô◊ì◊ï◊©",season:"◊°◊™◊ô◊ï ‚Ä¢ ◊™◊©◊®◊ô (◊°◊ï◊£ ◊™◊©◊®◊ô)",symbol:"◊®◊ô◊ß◊ï◊ì ◊¢◊ù ◊°◊§◊®◊ô ◊™◊ï◊®◊î",extra1:"◊û◊ó◊ñ◊ï◊® ◊™◊ï◊®◊î",extra2:"◊®◊ô◊ß◊ï◊ì ◊©◊û◊ó", image:"./photos/Torah_and_jad.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        hanukkah:{key:"hanukkah",name:"◊ó◊†◊ï◊õ◊î",story:"◊î◊ó◊©◊û◊ï◊†◊ê◊ô◊ù ◊ï◊§◊ö ◊î◊©◊û◊ü ◊ú◊©◊û◊ï◊†◊î ◊ô◊û◊ô◊ù",food:"◊ú◊ë◊ô◊ë◊ï◊™; ◊°◊ï◊§◊í◊†◊ô◊ï◊™",season:"◊™◊ó◊ô◊ú◊™ ◊ó◊ï◊®◊£ ‚Ä¢ ◊õ◊°◊ú◊ï",symbol:"◊ó◊†◊ï◊õ◊ô◊ô◊î/◊û◊†◊ï◊®◊î; ◊°◊ë◊ô◊ë◊ï◊ü",extra1:"◊†◊° ◊î◊©◊û◊ü",extra2:"◊©◊û◊ï◊†◊î ◊†◊®◊ï◊™", image:"./photos/hanukah NEROT.jpg", video:["./videos/HANNUKAH_1.mp4", "./videos/HANNUKAH_2.mp4", "./videos/HANNUKAH 3 SUFGANIOT.mp4", "./videos/HANNUKAH 4 SUFGANIOT.mp4"], song:"./audio files/MAOZ TSUR.m4a"},
        purim:{key:"purim",name:"◊§◊ï◊®◊ô◊ù",story:"◊ê◊°◊™◊® ◊ï◊û◊®◊ì◊õ◊ô ◊û◊°◊õ◊ú◊ô◊ù ◊ê◊™ ◊î◊û◊ü",food:"◊ê◊ï◊ñ◊†◊ô ◊î◊û◊ü",season:"◊°◊ï◊£ ◊ó◊ï◊®◊£ ‚Ä¢ ◊ê◊ì◊®",symbol:"◊û◊í◊ô◊ú◊î ◊ï◊®◊¢◊©◊ü",extra1:"◊°◊ô◊§◊ï◊® ◊ê◊°◊™◊®",extra2:"◊®◊¢◊©◊ü", image:"./photos/PURIM HAMENTASH.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        pesach:{key:"pesach",name:"◊§◊°◊ó",story:"◊ô◊¶◊ô◊ê◊™ ◊û◊¶◊®◊ô◊ù; ◊ó◊ô◊®◊ï◊™ ◊û◊¢◊ë◊ì◊ï◊™",food:"◊û◊¶◊î, ◊û◊®◊ï◊®, ◊ó◊®◊ï◊°◊™",season:"◊ê◊ë◊ô◊ë ‚Ä¢ ◊†◊ô◊°◊ü",symbol:"◊ß◊¢◊®◊™ ◊°◊ì◊® / ◊©◊ú◊ï◊© ◊û◊¶◊ï◊™",extra1:"◊ô◊¶◊ô◊ê◊™ ◊û◊¶◊®◊ô◊ù",extra2:"◊ú◊ó◊ù ◊û◊¶◊î", image:"./photos/PASSOVER MATZA A.jpg", video:"./videos/PASSOVER_1.mp4", song:"./audio files/HAVA NAGILA.m4a"},
        shavuot:{key:"shavuot",name:"◊©◊ë◊ï◊¢◊ï◊™",story:"◊û◊™◊ü ◊™◊ï◊®◊î ◊ë◊î◊® ◊°◊ô◊†◊ô",food:"◊¢◊ï◊í◊™ ◊í◊ë◊ô◊†◊î ◊ï◊û◊ê◊õ◊ú◊ô ◊ó◊ú◊ë",season:"◊™◊ó◊ô◊ú◊™ ◊ß◊ô◊• ‚Ä¢ ◊°◊ô◊ï◊ü",symbol:"◊ú◊ï◊ó◊ï◊™ / ◊°◊§◊® ◊™◊ï◊®◊î",extra1:"◊û◊™◊ü ◊™◊ï◊®◊î",extra2:"◊û◊†◊î◊í ◊ó◊ú◊ë◊ô", image:"./photos/2009_jni.jpg", video:"./videos/SHABBAT DATI.mp4", song:"./audio files/HAVA NAGILA.m4a"}
      }
    }
  };
  /* --------- App State --------- */
  const ROW_H = 70, CENTER_ROW = 1, CELEBRATION_MS = 9000, CONFETTI_COUNT = 300;
  let LANG = 'en', hintOn = false, reels = [], mode = 'medium', reelCount = 5, score = 0, timer = 120, timerId = null, powerUp = false, currentHoliday = null;
  const machine = document.getElementById('machine');
  const statusEl = document.getElementById('status');
  const hintBtn = document.getElementById('btn-hint');
  const infoBox = document.getElementById('info');
  const winBanner = document.getElementById('win-banner');
  const spinSound = document.getElementById('spin-sound');
  const winSound = document.getElementById('win-sound');
  const winVideo = document.getElementById('win-video');
  const holidayPhoto = document.getElementById('holiday-photo');
  const holidaySong = document.getElementById('holiday-song');
  const photoCard = document.getElementById('photo-card');
  const videoCard = document.getElementById('video-card');
  const songCard = document.getElementById('song-card');
  const comingEl = document.getElementById('coming');
  const $ = (s) => document.querySelector(s);
  function t() { return DATA[LANG]; }
  function H() { return t().holidays; }
  function getVideoPath(h) {
    return Array.isArray(h.video) ? h.video[Math.floor(Math.random() * h.video.length)] : h.video;
  }
  /* --------- Build UI with Media --------- */
  function build(reelNum = 5) {
    reelCount = reelNum;
    const titleEl = document.getElementById('title');
    if (titleEl) titleEl.textContent = t().ui.title;
    const subtitleEl = document.getElementById('subtitle');
    if (subtitleEl) subtitleEl.textContent = t().ui.subtitle;
    const spinAllEl = document.querySelector('[data-i18n="spinAll"]');
    if (spinAllEl) spinAllEl.textContent = t().ui.spinAll;
    const btnNewEl = document.getElementById('btn-new');
    if (btnNewEl) btnNewEl.textContent = t().ui.newRound;
    const lblStoryEl = document.getElementById('lbl-story');
    if (lblStoryEl) lblStoryEl.textContent = t().ui.cols.story;
    const lblFoodEl = document.getElementById('lbl-food');
    if (lblFoodEl) lblFoodEl.textContent = t().ui.cols.food;
    const lblSeasonEl = document.getElementById('lbl-season');
    if (lblSeasonEl) lblSeasonEl.textContent = t().ui.cols.season;
    const lblSymbolEl = document.getElementById('lbl-symbol');
    if (lblSymbolEl) lblSymbolEl.textContent = t().ui.cols.symbol;
    if (comingEl) comingEl.textContent = t().ui.coming;
    document.documentElement.lang = (LANG === 'he' ? 'he' : 'en');
    document.documentElement.dir = (LANG === 'he' ? 'rtl' : 'ltr');
    const langEnEl = document.getElementById('lang-en');
    if (langEnEl) langEnEl.classList.toggle('on', LANG === 'en');
    const langHeEl = document.getElementById('lang-he');
    if (langHeEl) langHeEl.classList.toggle('on', LANG === 'he');
    reels = []; if (machine) machine.innerHTML = "";
    const CATS = [
      {id:"name", label:`${t().ui.icons.name} ${t().ui.cols.name}`, get:(h)=>h.name},
      {id:"story", label:`${t().ui.icons.story} ${t().ui.cols.story}`, get:(h)=>h.story},
      {id:"food", label:`${t().ui.icons.food} ${t().ui.cols.food}`, get:(h)=>h.food},
      {id:"season", label:`${t().ui.icons.season} ${t().ui.cols.season}`, get:(h)=>h.season},
      {id:"symbol", label:`${t().ui.icons.symbol} ${t().ui.cols.symbol}`, get:(h)=>h.symbol},
      {id:"extra1", label:`${t().ui.icons.extra1} ${t().ui.cols.extra1}`, get:(h)=>h.extra1},
      {id:"extra2", label:`${t().ui.icons.extra2} ${t().ui.cols.extra2}`, get:(h)=>h.extra2}
    ].slice(0, reelNum);
    CATS.forEach((cat, i) => {
      const reel = document.createElement('div');
      reel.className = 'reel'; reel.dataset.i = i;
      const topChrome = document.createElement('div'); topChrome.className = 'chrome';
      const title = document.createElement('div'); title.className = 'title';
      title.innerHTML = `<span class="ico"></span> ${cat.label}`;
      const win = document.createElement('div'); win.className = 'window';
      const payline = document.createElement('div'); payline.className = 'payline';
      const strip = document.createElement('ul'); strip.className = 'strip';
      win.appendChild(strip); win.appendChild(payline);
      const particles = document.createElement('div'); particles.className = 'particles'; reel.appendChild(particles);
      reel.appendChild(topChrome); reel.appendChild(title); reel.appendChild(win);
      const ctrls = document.createElement('div'); ctrls.className = 'controls';
      const spinBtn = mini('Spin'), upBtn = mini('‚ñ≤'), downBtn = mini('‚ñº');
      ctrls.append(spinBtn, upBtn, downBtn); reel.appendChild(ctrls);
      if (machine) machine.appendChild(reel);
      const baseItems = Object.values(H()).map(h => ({key: h.key, text: cat.get(h), image: h.image}));
      shuffle(baseItems);
      const obj = {cat, items: baseItems, loop: null, index: baseItems.length, strip, payline, windowEl: win};
      const loop = [...baseItems, ...baseItems, ...baseItems];
      loop.forEach((it, idx) => {
        const li = document.createElement('li'); li.className = 'cell';
        li.innerHTML = it.image ? `<img src="${it.image}" alt="${it.text}"> ${it.text}` : it.text;
        li.onclick = () => snapToIndex(obj, idx);
        strip.appendChild(li);
      });
      obj.loop = loop; reels.push(obj);
      spinBtn.onclick = () => spin(obj);
      upBtn.onclick = () => nudge(obj, -1);
      downBtn.onclick = () => nudge(obj, 1);
    });
    applyAll(false);
    resetGame();
    if (statusEl) statusEl.textContent = ""; if (statusEl) statusEl.className = "status";
    if (infoBox) infoBox.style.display = "none"; if (winBanner) winBanner.classList.remove('show');
    if (photoCard) photoCard.style.display = "none";
    if (videoCard) videoCard.style.display = "none";
    if (songCard) songCard.style.display = "none";
    updateHint();
  }
  function mini(txt) {
    const b = document.createElement('button'); b.className = 'btn-mini'; b.textContent = txt; return b;
  }
  function shuffle(a) {
    for(let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }
  /* --------- Reel Mechanics --------- */
  function apply(r, animate=true) {
    if (!r || !r.strip) return;
    if (!animate) { r.strip.style.transition = 'none'; }
    const offset = (r.index - CENTER_ROW) * 70;
    r.strip.style.transform = `translateY(${-offset}px)`;
    if (!animate) { requestAnimationFrame(() => r.strip.style.transition = ''); }
  }
  function applyAll(animate=true) { reels.forEach(r => apply(r, animate)); }
  function nudge(r, dir) {
    if (!r) return;
    const L = r.loop.length;
    r.index = (r.index + dir + L) % L;
    apply(r);
    r.windowEl.classList.remove('stop'); void r.windowEl.offsetWidth; r.windowEl.classList.add('stop');
    updateHint(); checkWin();
  }
  function snapToIndex(r, loopIndex) {
    if (!r) return;
    r.index = loopIndex; apply(r);
    r.windowEl.classList.remove('stop'); void r.windowEl.offsetWidth; r.windowEl.classList.add('stop');
    checkWin(); updateHint();
  }
  function spin(r) {
    if (!r) return;
    let steps = 7 + Math.floor(Math.random() * 7), c = 0;
    playSpin();
    const t = setInterval(() => { nudge(r, 1); if (++c >= steps) { clearInterval(t); checkWin(); } }, 90);
  }
  function spinAll() {
    if (statusEl) statusEl.textContent = ""; if (statusEl) statusEl.className = "status";
    if (infoBox) infoBox.style.display = "none";
    if (photoCard) photoCard.style.display = "none";
    if (videoCard) videoCard.style.display = "none";
    if (songCard) songCard.style.display = "none";
    if (winBanner) winBanner.classList.remove('show');
    let i = 0; const next = () => { if (i >= reels.length) { setTimeout(checkWin, 140); return; } spin(reels[i++]); setTimeout(next, 120); };
    next();
  }
  function centerItem(r) {
    if (!r) return {key: '', text: '', image: ''};
    const len = r.items.length;
    const idx = ((r.index % len) + len) % len;
    return r.items[idx];
  }
  /* --------- Hint & ‚Äúone away‚Äù glow --------- */
  function updateHint() {
    if (hintBtn) hintBtn.textContent = hintOn ? t().ui.hintOn : t().ui.hintOff;
    const keys = reels.map(r => centerItem(r).key);
    const counts = {}; keys.forEach(k => counts[k] = (counts[k] || 0) + 1);
    const best = Object.keys(counts).sort((a, b) => counts[b] - counts[a])[0];
    const bestCount = best ? counts[best] : 0;
    reels.forEach(r => r.payline.classList.toggle('almost', bestCount === reelCount - 1));
    if (!hintOn) return;
    if (!best) { if (hintBtn) hintBtn.textContent = t().ui.hintOn; return; }
    const toFix = [];
    reels.forEach(r => {
      if (centerItem(r).key !== best) {
        const correct = r.items.find(it => it.key === best)?.text || "‚Äî";
        toFix.push(`${r.cat.label.replace(/^[^ ]+ /, '')}: ‚Äú${short(correct)}‚Äù`);
      }
    });
    if (hintBtn) hintBtn.textContent = toFix.length ? `${t().ui.hintOn} ‚Üí ${toFix.join("; ")}` : `${t().ui.hintOn} ‚Üí ${t().ui.looks}`;
  }
  function short(s) { return s.length > 28 ? s.slice(0, 25) + "‚Ä¶" : s; }
  /* --------- Win --------- */
  function checkWin() {
    const keys = reels.map(r => centerItem(r).key);
    const ok = keys.every(k => k === keys[0]);
    if (!ok) return;
    const h = Object.values(H()).find(x => x.key === keys[0]);
    currentHoliday = h; // Store for AI button
    if (statusEl) statusEl.className = "status success";
    if (statusEl) statusEl.textContent = t().ui.win(h.name);
    addScore(50); // Award points on win
    revealInfo(h);
    celebrate(h);
    reels.forEach(r => r.payline.classList.remove('almost'));
  }
  /* --------- Celebration --------- */
  function celebrate(h) {
    if (winBanner) winBanner.textContent = (LANG === 'he') ? "üéâ ◊†◊ô◊¶◊ó◊ï◊ü! üéâ" : "üéâ YOU WIN! üéâ";
    if (winBanner) winBanner.classList.add('show');
    setTimeout(() => { if (winBanner) winBanner.classList.remove('show'); }, CELEBRATION_MS);
    confetti(CONFETTI_COUNT);
    if (winVideo && h.video) {
      winVideo.currentTime = 0;
      winVideo.play();
    }
    if (winSound && h.song) {
      winSound.src = h.song;
      winSound.load();
      winSound.play();
    }
    jingle(); // Secondary effect
    const machineEl = document.querySelector('.machine');
    if (machineEl) machineEl.classList.add('win');
    setTimeout(() => { if (machineEl) machineEl.classList.remove('win'); }, CELEBRATION_MS);
    if (machineEl) createParticles(machineEl);
  }
  function confetti(n) {
    for (let i = 0; i < n; i++) {
      const d = document.createElement('div'); d.className = 'confetti';
      d.style.left = (Math.random() * 100) + "vw";
      d.style.background = `hsl(${Math.random() * 360}, 85%, 58%)`;
      document.body.appendChild(d);
      const dur = CELEBRATION_MS - 600 + Math.random() * 900, rot = 360 + Math.random() * 720, end = 105 + Math.random() * 10;
      d.animate([{transform: 'translateY(0) rotate(0deg)'}, {transform: `translateY(${end}vh) rotate(${rot}deg)`}], {duration: dur, easing: 'cubic-bezier(.2,.8,.2,1)'});
      setTimeout(() => d.remove(), dur + 160);
    }
  }
  function jingle() {
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)(), now = ctx.currentTime;
      const notes = [523.25, 659.25, 783.99, 1046.5, 1318.5, 1568.0];
      notes.forEach((f, i) => { const o = ctx.createOscillator(), g = ctx.createGain();
        o.type = 'triangle'; o.frequency.value = f; o.connect(g); g.connect(ctx.destination);
        const t = now + i * 0.14; g.gain.setValueAtTime(0, t); g.gain.linearRampToValueAtTime(.42, t + .06); g.gain.exponentialRampToValueAtTime(.0001, t + .8);
        o.start(t); o.stop(t + .82);
      });
    } catch(e) {}
  }
  /* --------- Info panel --------- */
  function revealInfo(h) {
    const infoTitleEl = document.getElementById('info-title');
    if (infoTitleEl) infoTitleEl.textContent = h.name;
    const iStoryEl = document.getElementById('i-story');
    if (iStoryEl) iStoryEl.textContent = h.story;
    const iFoodEl = document.getElementById('i-food');
    if (iFoodEl) iFoodEl.textContent = h.food;
    const iSeasonEl = document.getElementById('i-season');
    if (iSeasonEl) iSeasonEl.textContent = h.season;
    const iSymbolEl = document.getElementById('i-symbol');
    if (iSymbolEl) iSymbolEl.textContent = h.symbol;
    if (infoBox) infoBox.style.display = "";
    if (infoBox) infoBox.scrollIntoView({behavior: 'smooth', block: 'nearest'});
    if (photoCard && h.image) {
      photoCard.style.display = "block";
      holidayPhoto.src = h.image;
    }
    if (videoCard && h.video) {
      videoCard.style.display = "block";
      const source = winVideo.querySelector('source');
      source.src = getVideoPath(h);
      winVideo.load();
    }
    if (songCard && h.song) {
      songCard.style.display = "block";
      const source = holidaySong.querySelector('source');
      source.src = h.song;
      holidaySong.load();
    }
  }
  /* --------- New Challenge Functions --------- */
  function resetGame() {
    score = 0; timer = mode === 'easy' ? Infinity : 120; powerUp = false;
    if (statusEl) statusEl.textContent = `Score: ${score} | Time: ${timer}s`;
    if (timerId) clearInterval(timerId);
    if (timer !== Infinity) timerId = setInterval(() => { timer--; if (statusEl) statusEl.textContent = `Score: ${score} | Time: ${timer}s`; if (timer <= 0) endGame(); }, 1000);
  }
  function endGame() { alert('Time up! Final score: ' + score); build(reelCount); }
  function addScore(pts) { score += pts; if (score >= 200) powerUp = true; } // Use powerUp for auto-nudge
  /* --------- Audio Triggers --------- */
  function playSpin() { if (spinSound) spinSound.play(); }
  /* --------- Particles WOW --------- */
  function createParticles(el, count=20) {
    if (!el) return;
    for (let i = 0; i < count; i++) {
      const p = document.createElement('div'); p.className = 'particle';
      p.style.left = Math.random() * 100 + '%'; p.style.top = Math.random() * 100 + '%';
      p.style.animationDelay = Math.random() + 's';
      el.appendChild(p); setTimeout(() => p.remove(), 2000);
    }
  }
  /* --------- Event Handlers --------- */
  window.addEventListener('DOMContentLoaded', () => {
    build(5); // Initial build
    const langEnEl = document.getElementById('lang-en');
    if (langEnEl) langEnEl.onclick = () => { LANG = 'en'; build(reelCount); };
    const langHeEl = document.getElementById('lang-he');
    if (langHeEl) langHeEl.onclick = () => { LANG = 'he'; build(reelCount); };
    const btnSpinAllEl = document.getElementById('btn-spin-all');
    if (btnSpinAllEl) btnSpinAllEl.onclick = spinAll;
    const btnNewEl = document.getElementById('btn-new');
    if (btnNewEl) btnNewEl.onclick = () => build(reelCount);
    const leverEl = document.getElementById('lever');
    if (leverEl) leverEl.onclick = spinAll;
    if (hintBtn) hintBtn.onclick = () => { hintOn = !hintOn; updateHint(); };
    const btnEasyEl = document.getElementById('btn-easy');
    if (btnEasyEl) btnEasyEl.onclick = () => { mode = 'easy'; build(3); };
    const btnMediumEl = document.getElementById('btn-medium');
    if (btnMediumEl) btnMediumEl.onclick = () => { mode = 'medium'; build(5); };
    const btnHardEl = document.getElementById('btn-hard');
    if (btnHardEl) btnHardEl.onclick = () => { mode = 'hard'; build(7); };
    const aiAskEl = document.getElementById('ai-ask');
    if (aiAskEl) aiAskEl.onclick = () => {
      if (currentHoliday) {
        const query = `Tell me more about ${currentHoliday.name} Jewish holiday`;
        window.open(`https://grok.x.ai/?q=${encodeURIComponent(query)}`, '_blank');
      }
    };
  });
})();
</script>
</body>
</html>